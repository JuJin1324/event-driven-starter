# event-driven-starter

## EDM(Event Driven MicroService)
### 개요
> Event Driven MicroService(EDM)는 MSA가 적용된 시스템에서 이벤트 발생시 해당 이벤트 로그를 보관하고 이를 기반으로 동작하며, 
> 비동기 통신을 통해 시스템 내 통합(integration)을 수행하는 Architecture 입니다.  
> 
> **이벤트**  
> IT 영역에서 이벤트는 다양한 정의를 갖지만, 이 곳에서 언급하는 이벤트는 상태의 변경. 즉, 데이터의 변경,생성,삭제(CUD)를 통해 발생하는 서비스의 의미있는 변화를 뜻합니다.
> 
> **이벤트 로그를 보관**  
> 현재의 데이터는 상태 변경의 누적이라는 생각에서 시작합니다. 이 때 상태 변경은 이벤트를 뜻하고 이를 누적하는 행위는 이벤트 로그를 보관하는 것입니다. 
> EDM 에서 생성된 이벤트는 반드시 보관되어야 합니다. 보관된 이벤트는 데이터의 현재 상태를 구성하는 근간이 됩니다. 또한, 보관된 이벤트를 바탕으로 장애 발생 
> 또는 특정 요구사항에 따라 지정된 시점으로 복원을 수행합니다. 이벤트 로그를 보관하는 장소를 이벤트 스토어라 칭합니다.
> 
> **비동기 통신**  
> AMQP, MQTT, JMS 등 메세징 프로토콜을 통한 메세지 큐 방식이 자주 사용됩니다. 서비스에서 데이터의 생성,변경,삭제(CUD)를 통해 이벤트가 발생하면 
> 발행 서비스는 메세지의 형태로 이벤트를 발행하고, 해당 이벤트에 관심이 있는 서비스에서 구독을 수행합니다. 메세지 큐를 사용함으로 requeue/dlq 등의 기능을 활용할 수 있습니다.
> 
> **시스템 내 통합(integration)**  
> 이상적으로 구현된 MSA는 서비스 간 데이터 참조를 위한 내부 통신이 필요없지만, 현실적으로 서비스 간 내부 통신이 전혀 없는 시스템을 구현하기란 불가능에 가깝습니다. 
> 다양한 사유로 여러 서비스 간 통신을 통해 연동이 발생합니다.  

### 왜 Event Driven MicroService 를 적용하는가?
> MSA를 적용한 시스템은 서비스가 쪼개지고 Database가 쪼개집니다. MSA 에서 주요 원칙 중 하나는 서비스 별 자체 비즈니스 로직과 데이터, 그에 따른 최적의 Database 를 선택하는 것입니다.    
> Database Per Service 는 MSA의 느슨한 결합, 관심사의 집중, 폴리글랏 프로그래밍, 독립적인 배포 주기 등을 달성하기 위한 핵심 키워드입니다.  

### 분산 트랜잭션 처리
> 기존의 Lagacy 시스템에서 문제 발생시 일관된 commit 또는 rollback 처리나 이전에 발생한 상태 변경에 직접 접근해서 데이터 수정이 가능합니다. 
> 하지만 MSA가 적용된 시스템에서 서로 다른 서비스에 걸쳐진 기능을 수행하는 도중 일관된 commit 또는 rollback을 수행할 수 없습니다. 
> 이 때 EDM을 적용해 rollback 또는 retry를 처리할 수 있습니다. rollback이 필요한 경우 Failed 이벤트를 발생시키고, 
> 이를 이전 스텝을 수행한 서비스에서 구독하여 보관되어 있던 이벤트 로그 기반으로 rollback을 수행합니다. 
> retry가 필요한 경우 메세지 큐의 requeue 또는 dead letter queue 기능을 사용해 retry 처리를 수행할 수 있습니다.

### 참조사이트
> [Event Driven Architecture란?](https://medium.com/dtevangelist/event-driven-microservice-란-54b4eaf7cc4a)

---

## EDA(Event Driven Architecture)
### 개요
> 분산된 시스템에서 이벤트를 생성(발행)하고 발행된 이벤트를 수신자에게 전송하는 구조로 수신자는 그 이벤트를 처리하는 방식의 아키텍처입니다.  
> 분산 아키텍처 환경에서 상호 간 결합도를 낮추기 위해 비동기 방식으로 메시지를 전달하는 패턴으로 주로 Message Broker(Kafka, RabbitMQ)와 결합하여 구성됩니다.  

### EDA의 구성요소
> **Event Generator (Publisher, Producer, Creater)**  
> 표준화된 형식의 이벤트를 생성(발행)합니다. 생성된 이벤트는 Event Channel로 전송합니다.
> 
> **Event Channel (Bus)**  
> Event Generator에서 Event Processing Engine으로 수집된 데이터를 전파하는 메커니즘입니다.
> 즉, 이벤트를 필요로 하는 시스템까지 발송하는 역할입니다.
> 
> **Event Processing Engine (Consumer, Processor)**  
> 수신한 이벤트를 식별/처리하는 역할을 합니다. 처리 결과에 따라 새로운 이벤트를 생성할 수 있습니다.
> Consumer는 이벤트의 송신자에 대한 정보를 알 필요가 없습니다.

### EDA의 동작 방식
> **Message 생성 (Publish/Subscribe)**  
> 이벤트가 생성되면 Subscriber(수신자)에게 전달합니다.
> 이벤트는 반복되어 전달되지 않으며, 수신자는 송신자의 정보를 알 필요가 없습니다.
> 
**Event Source**  
> Event Processor에게 이벤트를 전달하는 역할을 합니다.
> Event Source는 1개 이상일 수 있으며, 1개 이상의 Event Processor에게 전달합니다.
> 
> **Event Processor**  
> 수신된 이벤트에 대한 여러 Action을 수행하는 역할입니다.
> 단일 이벤트에 대하여 타임스템프를 추가한다거나, 파생 이벤트를 만드는 등의 작업을 수행합니다.
> 
> **Event Consumer**  
> 이벤트에 대한 처리를 합니다. 실질적인 Biz Logic을 수행합니다.

### 토폴로지 구성
> 일반적으로 한가지 작업만 필요한 단순한 단일 이벤트일 경우에는 `Broker Topology` 를
> 이벤트 조율이 필요한 복잡한 이벤트 플로우일 경우 `Mediator Topology` 를 사용합니다.
> 
> **Mediator Topology (중재자 토폴로지)**  
> 여러 단계의 과정을 중재자를 통해 조율할 필요성이 있으면 일반적으로 사용합니다.
> 동시에 처리하지 않거나 실행 전에 처리해야 할 요소가 있으 사용하는 토폴로지입니다.
> 큐를 이용하여 사전처리를 진행한 후 관련된 Consumer에게 전달합니다.
> 
> **Broker Topology (브로커 토폴로지)**  
> 큐나 중재자 없이 이벤트와 응답을 직접적으로 연관시키고자 할 때 사용합니다.
> 이벤트 플로우가 단순한 중앙집중식 토폴로지이며 Message Broker 와 Consumer 가 가장 중요한 요소입니다.
> 모든 작업은 비동기로 처리되며 이벤트에 대한 조율이 필요 없습니다.

### EDA의 장단점
> **장점**  
> 1. Loosely Coupling: 분산 시스템간 느슨한 결합도를 제공합니다.
> 2. 분산된 시스템간 의존성 배제: 약속된 Message를 통해 통신하기 때문에 다른 시스템의 정보를 알 필요가 없으므로 시스템 간 의존성이 배제됩니다.
> 3. 확장성, 탄력성 향상
> 
> **단점**  
> 1. Broker Dependency: 시스템 간 의존도는 낮아지지만 메시지브로커에 대한 의존성이 발생합니다. 만약 메시지 브로커의 장애가 발생하면 큰 장애로 확산될 가능성이 있습니다.
> 2. Transaction 단위 분리: 장애나 이슈발생시 Retry/Rollback에 대한 고려가 필요합니다.
> 3. 시스템 Flow파악이 어려움
> 4. 디버깅이 어려움

### EDA를 선택할 때 고려할 특징
> **Multicast 통신**  
> 한 개의 이벤트 Publisher는 다양한 Consumer에게 이벤트를 전달할 수 있습니다.
> 
> **실시간 전송**  
> 실시간으로 발생하는 이벤트에 대한 처리가 가능합니다.
> 
> **비동기 통신**  
> 비동기로 통신이 이루어지므로 Publisher는 처리 결과를 기다릴 필요가 없습니다.
> 
> **세밀한 통신**  
> 한 덩어리의 큰 이벤트(데이터)보다 작고 자세한 이벤트로 통신이 이루어집니다.
> 
> **이벤트 온톨로지**  
> 이벤트들은 확실하게 구분된 특징을 지니며 그에 상응하는 Consumer에게 전달됩니다.
> 
> **자유로운 배포**  
> 느슨할 결합도를 제공하므로 새로운 서비스의 배포가 자유롭습니다.

### 참조사이트
> [EDA(Event Driven Architecture)이란?](https://akasai.space/architecture/about_event_driven_architecture/)

## Spring Event
> 
